machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker build --rm=false -t auth0-express-api-rs256 . 

test:
  #override:
  #  - docker run --env-file .env -p 3010:3010 -it auth0-express-api-rs256 
  #    background: true
  #  -sleep 7
    #- curl --retry 10 --retry-delay 5 -v http://localhost:3010
  #  - npm test
  run:
    name: execute server pre-test
    command: docker run --env-file .env -p 3010:3010 -it auth0-express-api-rs256
    background: true
  
  run:
    name: execute test suite
    command: npm test
