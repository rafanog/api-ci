version: 2
jobs:
  build:
    working_directory: ~/repo
    docker:
      - image: circleci/node:9.4.0
      - image: docker:17.05.0-ce-git
      
    steps:
      - checkout
      - setup_remote_docker
      
      - run:
          name: prepare backbround server
          command: |
             echo "AUTH0_DOMAIN=$domain" >> .env
             echo "AUTH0_AUDIENCE=$audience" >> .env
           
      - run: 
          name: build docker image
          command: docker build -t auth0-express-api-rs256 .
      
      - run: 
          name: run background server
          command: docker run --env-file .env -p 3010:3010 -it auth0-express-api-rs256
          background: true
