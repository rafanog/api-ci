version: 2
jobs:
  build:
    working_directory: /app
    docker:
      - image: docker:17.05.0-ce-git
      - image: circleci/node:9.4.0
    steps:
      - checkout
      - setup_remote_docker
      
      - run:
          name: prepare backbround server
          command: |
             echo "AUTH0_DOMAIN=$domain" >> .env
             echo "AUTH0_AUDIENCE=$audience" >> .env
           
      - run: 
          name: background server for tests
          command: sh exec.sh 
          background: true
      
      - run: sleep 10
      
      - run: 
          name: test
          command: |
            cd test 
            node -v
            #apt-get install nodejs
            #apt-get install npm
            #echo "AUTH0_DOMAIN=$domain" >> .env
            #echo "AUTH0_AUDIENCE=$audience" >> .env
            #echo "AUTH0_CLIENT_ID_1=$id1" >> .env
            #echo "AUTH0_CLIENT_SECRET_1=$secret1" >> .env
            #echo "AUTH0_CLIENT_ID_2=$id2" >> .env
            #echo "AUTH0_CLIENT_SECRET_2=$secret2" >> .env
            #echo "AUTH0_CLIENT_ID_3=$id3" >> .env
            #echo "AUTH0_CLIENT_SECRET_3=$secret3" >> .env
            #echo "AUTH0_CLIENT_ID_4=$id4" >> .env
            #echo "AUTH0_CLIENT_SECRET_4=$secret4" >> .env
            #echo "API_URL=http://localhost:3010" >> .env
            npm test
            
          
      
